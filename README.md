# Тестовое задание на позицию стажера-бекендера

## Микросервис для работы с балансом пользователей.

**Задача:**

Необходимо реализовать микросервис для работы с балансом пользователей (зачисление средств, списание средств, перевод средств от пользователя к пользователю, а также метод получения баланса пользователя). Сервис должен предоставлять HTTP API и принимать/отдавать запросы/ответы в формате JSON. 

**Выполнено:**

1. Метод начисления средств на баланс. Принимает id пользователя и сколько средств зачислить.
2. Метод списания средств с баланса. Принимает id пользователя и сколько средств списать.
3. Метод перевода средств от пользователя к пользователю. Принимает id пользователя с которого нужно списать средства, id пользователя которому должны зачислить средства, а также сумму.
4. Метод получения текущего баланса пользователя. Принимает id пользователя. Баланс всегда в рублях.
5. Доп. Задание 1. Получение баланса в валюте отличной от рубля.

## Как использовать ##

**Создание и запуск докер образа с миграциями**
```sh
make build
make run
make migrate-up
```

**Примеры запросов к сервису**

Сервис тестировался с использованием Postman.

**/deposit**

Предполагается, что пользователь зарегистрирован на сайте и внесен в БД.

Запрос:
```sh
{
    "id": "first",
    "balance": 123
}
```
Ответ:
```sh
{
    "id": "first",
    "balance": 123
}
```
Запрос:
```sh
{
    "id": "first",
    "balance": 123
}
```
Ответ:
```sh
{
    "id": "first",
    "balance": 246
}
```

**/writeOff**

В случае, если у пользователя недостаточно средств на балансе, будет отправлена ошибка и актуальный баланс

Запрос:
```sh
{
    "id": "first",
    "balance": 11
}
```
Ответ:
```sh
{
    "id": "first",
    "balance": 112
}
```
Ответ с ошибкой:
```sh
{
    "text": "insufficient funds in the account, current balance: 90.000000"
}
```

**/transfer**

В случае, если у 1 из пользователей недостаточно средств на балансе, будет отправлена ошибка и призыв проверить свой баланс

UserWO - пользователь счета, с которого будут списаны средства

UserDep - пользователь счета, на который будут зачислены средства

Запрос:
```sh
{
    "userWO": "first",
    "userDep": "forty",
    "balance": 11
}
```
Ответ:
```sh
{
    "userWO": "first",
    "userDep": "forty",
    "balance": 11
}
```
Ответ с ошибкой:
```sh
{
    "text": "insufficient funds in the write off account, check your balance"
}
```

**/getBalance**

Запрос:
```sh
{
    "id": "first"
}
```
Ответ:
```sh
{
    "id": "first",
    "balance": 90
}
```
Запрос c ошибкой:
```sh
{
    "id": "pervii"
}
```
Ответ с ошибкой:
```sh
{
    "text": "error take balance: sql: no rows in result set"
}
```

**/getBalanceCurrency**

Поскольку по умолчанию валюта установлена в рублях, в случае отсутствия поля currency, баланс пользователя будет отправлен в рублях

Запрос:
```sh
{
    "id": "first",
    "currency": "USD"
}
```
Ответ:
```sh
{
    "id": "first",
    "currency": "USD",
    "balance": 1.53981
}
```
Запрос c отсутствием поля currency:
```sh
{
    "id": "first",
    "currency": 123
}
```
Ответ с отсутствием поля currency:
```sh
{
    "text": "Invalid field"
}
```